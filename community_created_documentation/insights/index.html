


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.12">
    
    
      
        <title>ElectricRCAircraftGuy - Google Test Docs Mirror</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4dd2dd8d.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#the-nuances" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="Google Test Docs Mirror" class="md-header-nav__button md-logo" aria-label="Google Test Docs Mirror">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Google Test Docs Mirror
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              ElectricRCAircraftGuy
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/google/googletest" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Google Test
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Google Test Docs Mirror" class="md-nav__button md-logo" aria-label="Google Test Docs Mirror">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Google Test Docs Mirror
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/google/googletest" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Google Test
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Google Test
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Google Test" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Google Test
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../gtest/googletest/docs/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../gtest/googletest/docs/primer/" title="Primer" class="md-nav__link">
      Primer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../gtest/googletest/docs/faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../gtest/googletest/docs/advanced/" title="Advanced" class="md-nav__link">
      Advanced
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../gtest/googletest/docs/pkgconfig/" title="pkg-config" class="md-nav__link">
      pkg-config
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../gtest/googletest/docs/samples/" title="Samples" class="md-nav__link">
      Samples
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Google Mock
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Google Mock" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Google Mock
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../gtest/googlemock/docs/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../gtest/googlemock/docs/for_dummies/" title="For Dummies" class="md-nav__link">
      For Dummies
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../gtest/googlemock/docs/cheat_sheet/" title="Cheat Sheet" class="md-nav__link">
      Cheat Sheet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../gtest/googlemock/docs/cook_book/" title="Cookbook" class="md-nav__link">
      Cookbook
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../gtest/googlemock/docs/gmock_faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../gtest/googlemock/docs/pump_manual/" title="Pump Manual" class="md-nav__link">
      Pump Manual
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-7" type="checkbox" id="nav-3-7" checked>
    
    <label class="md-nav__link" for="nav-3-7">
      Community Created Documentation
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Community Created Documentation" data-md-level="2">
      <label class="md-nav__title" for="nav-3-7">
        <span class="md-nav__icon md-icon"></span>
        Community Created Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../gtest/googlemock/docs/community_created_documentation/" title="Links" class="md-nav__link">
      Links
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        ElectricRCAircraftGuy
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" title="ElectricRCAircraftGuy" class="md-nav__link md-nav__link--active">
      ElectricRCAircraftGuy
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-nuances" class="md-nav__link">
    The nuances:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-documentation" class="md-nav__link">
    The documentation:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#some-subtle-rules-to-remember-in-general" class="md-nav__link">
    Some subtle rules to remember in general:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-answers" class="md-nav__link">
    The answers:
  </a>
  
    <nav class="md-nav" aria-label="The answers:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#question-1-if-i-call-expect_call-twice-on-the-same-mock-object-in-the-same-test_f-what-happens" class="md-nav__link">
    Question 1: "If I call EXPECT_CALL twice on the same mock object in the same TEST_F . . . what happens?"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-2-are-the-expectations-appended-to-the-mock-object-or-does-the-second-call-erase-the-effects-of-the-first-call" class="md-nav__link">
    Question 2: "Are the expectations appended to the mock object or does the second call erase the effects of the first call?"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-3-can-i-call-expect_call-to-set-some-expectations-on-a-mock-method-call-the-mock-method-then-call-expect_call-on-the-method-again-to-change-the-expectations-then-call-the-mock-method-again" class="md-nav__link">
    Question 3: Can I call EXPECT_CALL to set some expectations on a mock method, call the mock method, then call EXPECT_CALL on the method again to change the expectations, then call the mock method again?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practice-using-gtestgmock" class="md-nav__link">
    Practice using gtest/gmock:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related" class="md-nav__link">
    Related:
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-nuances" class="md-nav__link">
    The nuances:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-documentation" class="md-nav__link">
    The documentation:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#some-subtle-rules-to-remember-in-general" class="md-nav__link">
    Some subtle rules to remember in general:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-answers" class="md-nav__link">
    The answers:
  </a>
  
    <nav class="md-nav" aria-label="The answers:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#question-1-if-i-call-expect_call-twice-on-the-same-mock-object-in-the-same-test_f-what-happens" class="md-nav__link">
    Question 1: "If I call EXPECT_CALL twice on the same mock object in the same TEST_F . . . what happens?"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-2-are-the-expectations-appended-to-the-mock-object-or-does-the-second-call-erase-the-effects-of-the-first-call" class="md-nav__link">
    Question 2: "Are the expectations appended to the mock object or does the second call erase the effects of the first call?"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-3-can-i-call-expect_call-to-set-some-expectations-on-a-mock-method-call-the-mock-method-then-call-expect_call-on-the-method-again-to-change-the-expectations-then-call-the-mock-method-again" class="md-nav__link">
    Question 3: Can I call EXPECT_CALL to set some expectations on a mock method, call the mock method, then call EXPECT_CALL on the method again to change the expectations, then call the mock method again?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practice-using-gtestgmock" class="md-nav__link">
    Practice using gtest/gmock:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related" class="md-nav__link">
    Related:
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                  <h1>ElectricRCAircraftGuy</h1>
                
                <p>insights.md
-a detailed look at some aspects of the proper usage of googlemocks/googletest</p>
<p>By <a href="https://github.com/ElectricRCAircraftGuy">Gabriel Staples</a>
30 Mar. 2020</p>
<p>This answer was originally <a href="https://stackoverflow.com/questions/44034633/google-mock-can-i-call-expect-call-multiple-times-on-same-mock-object/60905880#60905880">posted on Stack Overflow here</a> to answer this question: "<strong>google mock - can I call EXPECT_CALL multiple times on same mock object?</strong>"</p>
<p>It acts as a good intro. to the googletest/googlemock documentation, as well as an advanced guide with a bunch of insights into properly using gmock's <code>EXPECT_CALL()</code> macro.</p>
<p>Here it is:</p>
<hr />
<p><em>All of the below code was tested with Googletest/Googlemock <a href="https://github.com/google/googletest/releases">v1.10.0</a>, which was released 3 Oct. 2019.</em></p>
<p>If you'd like to run tests for yourself but don't have googletest or googlemock set up on your system, <a href="https://github.com/ElectricRCAircraftGuy/eRCaGuy_gtest_practice">here's a bare-bones project I created</a> to get it up and running quickly on Ubuntu. Go clone it and play with it yourself. It may act as a starting point to help you get it running on Mac or Windows as well.</p>
<p>This is a really important question, so I feel compelled to have a hack at it.</p>
<h2 id="the-nuances">The nuances:<a class="headerlink" href="#the-nuances" title="Permanent link">&para;</a></h2>
<p>Let me start by saying that Google Mock (gmock) is <em>nuanced</em>. That means there are lots of subtleties to understand, and this is difficult. Even the documentation is a bit scattered, and you kind of need to carefully read and study <em>it all</em> to really grasp some or even most of these nuances, since they don't do a good job of repeating certain important points in each of the documents. So, here is all of the official documentation: if you're doing this for work, tell your supervisor you are going to set aside several days to carefully go through the gtest and gmock documentation and to practice examples to get a strong grasp on it.</p>
<h2 id="the-documentation">The documentation:<a class="headerlink" href="#the-documentation" title="Permanent link">&para;</a></h2>
<p><em>As you read and study the below documentation, save each one as (print it to) a PDF, then use <a href="https://www.foxitsoftware.com/pdf-reader/">Foxit Reader</a> for free on Windows, Mac, or Linux, to edit, take notes in, and highlight or underline the PDF as you go. This way you have notes of the most important things you need to remember. See my <code>*_GS_edit.pdf</code> PDFs <a href="https://github.com/ElectricRCAircraftGuy/eRCaGuy_dotfiles/tree/master/googletest/gtest">here</a> and <a href="https://github.com/ElectricRCAircraftGuy/eRCaGuy_dotfiles/tree/master/googletest/gmock">here</a> for examples of taking notes and marking up PDFs that I have done as I've learned Google Test and Google Mock.</em></p>
<p><strong>Official Google Documentation:</strong></p>
<ol>
<li>gtest: it's all in this folder: https://github.com/google/googletest/tree/master/googletest/docs. The key documents to study, in this order probably, are the:<ol>
<li><strong>primer</strong></li>
<li><strong>FAQ</strong></li>
<li><strong>samples</strong> (look at and carefully study the source code for <em>at least</em> the first 3 samples)</li>
<li>advanced</li>
</ol>
</li>
<li>gmock: it's all in this folder: https://github.com/google/googletest/tree/master/googlemock/docs. The key documents to study, in this order probably, are the:<ol>
<li><strong>for dummies</strong></li>
<li><strong>cook book</strong></li>
<li><strong>cheat sheet</strong> - this is the best one-stop-shop or "summary of gmock rules" of all of the docs, but lacks some things that are even spelled out explicitly in (and only in) the "for dummies" manual that you will need in addition to this doc.</li>
<li><strong>FAQ</strong></li>
<li><strong>for dummies</strong> &lt;-- yes, AGAIN! AFTER doing and attempting to write a bunch of tests and mocks, then <em>come back</em> and re-read this document again! It will make sooo much more sense the 2nd time around after putting gtest and gmock principles into practice yourself first.</li>
</ol>
</li>
</ol>
<h2 id="some-subtle-rules-to-remember-in-general">Some subtle rules to remember in general:<a class="headerlink" href="#some-subtle-rules-to-remember-in-general" title="Permanent link">&para;</a></h2>
<ol>
<li>"Remember that the test order is undefined, so your code can't depend on a test preceding or following another" (https://github.com/google/googletest/blob/master/googletest/docs/advanced.md#sharing-resources-between-tests-in-the-same-test-suite).</li>
<li>"<strong>Important note:</strong> gMock requires expectations to be set <strong>before</strong> the mock functions are called, otherwise the behavior is <strong>undefined</strong>. In particular, you mustn't interleave <code>EXPECT_CALL()</code>s and calls to the mock functions" (https://github.com/google/googletest/blob/master/googlemock/docs/for_dummies.md#using-mocks-in-tests)</li>
</ol>
<hr />
<h2 id="the-answers">The answers:<a class="headerlink" href="#the-answers" title="Permanent link">&para;</a></h2>
<h3 id="question-1-if-i-call-expect_call-twice-on-the-same-mock-object-in-the-same-test_f-what-happens">Question 1: "If I call <code>EXPECT_CALL</code> twice on the same mock object in the same <code>TEST_F</code> . . . what happens?"<a class="headerlink" href="#question-1-if-i-call-expect_call-twice-on-the-same-mock-object-in-the-same-test_f-what-happens" title="Permanent link">&para;</a></h3>
<p>A: First off, whether your're using the <code>TEST()</code> macro or the <code>TEST_F()</code> macro in this case makes no difference. The <code>TEST()</code> macro simply expands into a class which publicly inherits from the <code>::testing::Test</code> class, and the <code>TEST_F()</code> macro simply expands into a class which inherits from your test fixture class (the first parameter to <code>TEST_F()</code>), which must publicly inherit from the <code>::testing::Test</code> class.</p>
<p>Many <code>EXPECT_CALL</code>s can be called on the same mock object (mock class), from general to specific, as follows:</p>
<p><strong>The 3 rules of multiple <code>EXPECT_CALL</code>s on the same mock object:</strong>
From most generic --&gt; most specific (AKA: "outer" --&gt; "inner" scope).</p>
<ol>
<li><strong>You can have <em>at least</em> one <code>EXPECT_CALL</code> per mock method:</strong> One mock class can have many mocked methods, so each method may have one or more <code>EXPECT_CALL</code>s configuring the expected interaction with that method. Therefore, a mock class can have <em>at least</em> one <code>EXPECT_CALL</code> per method.</li>
<li>
<p><strong>You <em>shouldn't have more than one</em> <code>EXPECT_CALL</code> per matcher signature on a single mock method:</strong> (Read more on this in Rule 3 below). Each mock method has many different parameter <em>values</em> that can be passed in, so you can have <em>up to</em> one <code>EXPECT_CALL</code> per matcher signature (possible parameter value or combination of values, in the event of multiple input parameters). This means each mock method can have potentially many <em>thousands</em> or even <em>millions or billions</em> of <em>valid and unique</em> <code>EXPECT_CALL</code>s attached to it, each matching a different set of "matchers", or input parameters to the mocked method. For example, this is perfectly valid:</p>
<pre><code>// Each `EXPECT_CALL()` in this example has a different and
// unique "matcher" signature, so every `EXPECT_CALL()` will
// take effect for its matching parameter signature when
// `myMockMethod()` is called.
//                                    v--matchers
EXPECT_CALL(myMockClass, myMockMethod(1));
EXPECT_CALL(myMockClass, myMockMethod(2));
EXPECT_CALL(myMockClass, myMockMethod(3));
EXPECT_CALL(myMockClass, myMockMethod(4));
EXPECT_CALL(myMockClass, myMockMethod(5));
...
EXPECT_CALL(myMockClass, myMockMethod(1000));
</code></pre>
<p>In particular, the above <code>EXPECT_CALL</code>s each specify that a call to <code>myMockMethod()</code> with that matching signature must occur <em>exactly 1 time</em>. That's because the <a href="https://github.com/google/googletest/blob/master/googlemock/docs/for_dummies.md#cardinalities-how-many-times-will-it-be-called">cardinality rules</a> in this case dictate than an implicit <code>.Times(1)</code> is present on each of those <code>EXPECT_CALL</code>s, even though you don't see it written.</p>
<p>To specify that you want a given <code>EXPECT_CALL</code> to mach <em>any</em> input value for a given parameter, use the <code>::testing::_</code> matcher, like this:</p>
<pre><code>using ::testing::_;

EXPECT_CALL(myMockClass, myMockMethod(_));
</code></pre>
</li>
<li>
<p><strong>Don't have <em>duplicate <code>EXPECT_CALL</code>s with the same matcher signature</em> on the same mock method, but <em>multiple</em> <code>EXPECT_CALL</code>s with <em>overlapping/overriding</em> (but NOT duplicate) matcher signatures on the same mock method are OK:</strong> If you attach more than one <code>EXPECT_CALL</code> to the same <em>matching values</em>, only <em>the last one set</em> will have any effect. See <a href="https://github.com/google/googletest/blob/master/googlemock/docs/for_dummies.md#using-multiple-expectations-multiexpectations">here</a>, <a href="https://github.com/google/googletest/blob/master/googlemock/docs/for_dummies.md#all-expectations-are-sticky-unless-said-otherwise-stickyexpectations">here</a>, and <a href="https://github.com/google/googletest/blob/master/googlemock/docs/cook_book.md#performing-different-actions-based-on-the-arguments">here</a>, for instance. This means if you have two or more <code>EXPECT_CALL</code>s with duplicate matcher signatures (the same parameters passed to the mock method), then ONLY THE LAST ONE WILL EVER GET ANY CALLS.</p>
<p>Therefore, your test will ALWAYS FAIL except in the unusual case that all <code>EXPECT_CALL</code>s except the last one have a <code>.Times(0)</code> value, specifying that they will <em>never</em> be called, as indeed this is the case: the last <code>EXPECT_CALL</code> will match all of the calls for these matchers and all duplicate <code>EXPECT_CALL</code>s above it will have <em>no</em> matching calls! Here is an example of a test which will <strong>always fail</strong> as a result of this behavior. This is the main behavior that @luantkow focuses on <a href="https://stackoverflow.com/a/44035118/4561887">in his answer here</a>.</p>
<pre><code>using ::testing::_;

// Notice they all have the same mock method parameter "matchers"
// here, making only the last `EXPECT_CALL()` with this matcher
// signature actually match and get called. Therefore, THIS TEST
// WILL ***ALWAYS FAIL***, since EXPECT_CALL #1 expects to get
// called 1 time but is NEVER called, #2 through #1006, inclusive,
// all expect to get called 2 times each but all of them are NEVER
// called, etc.! Only #1007 is ever called, since it is last and
// therefore always matches first.
//                                    v--matchers
EXPECT_CALL(myMockClass, myMockMethod(_)).Times(1); // EXPECT_CALL #1
EXPECT_CALL(myMockClass, myMockMethod(_)).Times(2); // EXPECT_CALL #2
EXPECT_CALL(myMockClass, myMockMethod(_)).Times(2); // EXPECT_CALL #3
EXPECT_CALL(myMockClass, myMockMethod(_)).Times(2); // EXPECT_CALL #4
EXPECT_CALL(myMockClass, myMockMethod(_)).Times(2); // EXPECT_CALL #5
EXPECT_CALL(myMockClass, myMockMethod(_)).Times(2); // EXPECT_CALL #6
// ... duplicate the line just above 1000 more times here
EXPECT_CALL(myMockClass, myMockMethod(_)).Times(3); // EXPECT_CALL #1007
</code></pre>
<p>This weird exception, however, makes the test valid simply by setting all duplicate <code>EXPECT_CALL</code>s, <em>except for the last one</em>, to have a <code>.Times(0)</code> cardinal setting:</p>
<pre><code>using ::testing::_;

// Notice they all have the same mock method parameter "matchers"
// here, making only the last `EXPECT_CALL()` with this matcher
// signature actually match and get called. However, since all previous
// `EXCEPT_CALL` duplicates are set to `.Times(0)`, this test is valid
// and can pass.
//                                    v--matchers
EXPECT_CALL(myMockClass, myMockMethod(_)).Times(0); // EXPECT_CALL #1
EXPECT_CALL(myMockClass, myMockMethod(_)).Times(0); // EXPECT_CALL #2
EXPECT_CALL(myMockClass, myMockMethod(_)).Times(0); // EXPECT_CALL #3
EXPECT_CALL(myMockClass, myMockMethod(_)).Times(0); // EXPECT_CALL #4
EXPECT_CALL(myMockClass, myMockMethod(_)).Times(0); // EXPECT_CALL #5
EXPECT_CALL(myMockClass, myMockMethod(_)).Times(0); // EXPECT_CALL #6
// ... duplicate the line just above 1000 more times here
EXPECT_CALL(myMockClass, myMockMethod(_)).Times(3); // EXPECT_CALL #1007
</code></pre>
<p>Here, only <code>EXPECT_CALL</code> #1007 (the very last <code>EXPECT_CALL</code>) will ever match a call to <code>myMockMethod()</code>, and <code>Times(3)</code> will be in effect. Since all duplicate <code>EXPECT_CALL</code>s above this one will NEVER MATCH AND GET CALLED, since they are never reached, tests with duplicate <code>EXPECT_CALL</code>s for a given matcher would ALWAYS FAIL for any <code>.Times()</code> value other than <code>.Times(0)</code> for all non-last-place duplicate <code>EXPECT_CALL</code>s.</p>
<p>This effect of making later matchers have the ability to override earlier matchers is <em>intentional</em> and part of the Googlemock design, as it allows you to create a very useful kind of hierarchy of expected calls, based on value passed to the mock method, like this:</p>
<pre><code>using ::testing::_;

// Most general matchers first (_ matches any input value)
EXPECT_CALL(myMockClass, myMockMethod(_)).Times(1);
// More specific matchers next, to override the more general matcher
// above if they match
EXPECT_CALL(myMockClass, myMockMethod(7)).Times(2);
EXPECT_CALL(myMockClass, myMockMethod(5)).Times(4);
</code></pre>
<p>The various google documents say that matching <code>EXPECT_CALL</code>s are searched for in <em>reverse order</em>, from <em>bottom to top</em>. So, if <code>myMockMethod(8)</code> is called, it will be checked against the last <code>EXPECT_CALL</code> for this method, which is looking for <code>myMockMethod(5)</code>. That doesn't match, so it goes up one and checks against <code>myMockMethod(7)</code>. That doesn't match, so it goes up one and checks against <code>myMockMethod(_)</code>. This matches! So, it counts as the one call authorized by the <code>Times(1)</code> cardinal value.</p>
<p>So, what you've defined above is this: we expect <code>myMockMethod(5)</code> to be called 4 times, <code>myMockMethod(7)</code> to be called 2 times, and <code>myMockMethod(anything_other_than_5_or_7)</code> to be called 1 time. For more reading on this topic, see my other answer here: https://stackoverflow.com/questions/44249293/google-mock-how-to-say-function-must-be-called-once-with-a-certain-parameter/60896373#60896373.</p>
</li>
</ol>
<p><strong>Key summary:</strong> the main point to remember regarding the question "Can I call <code>EXPECT_CALL</code> multiple times on same mock object?", is this: you can only call <code>EXPECT_CALL</code> multiple times on the same mock object <em>and method</em> if the matchers (arguments specified to be passed to the mocked method) are <em>different</em> for each <code>EXPECT_CALL</code>. That is, of course, unless you set <code>.Times(0)</code> on all but the last duplicate <code>EXPECT_CALL</code>, which makes them useless, so just remember instead to not have duplicate <code>EXPECT_CALL</code>s with the same matchers.</p>
<p>That fully answers this question.</p>
<hr />
<h3 id="question-2-are-the-expectations-appended-to-the-mock-object-or-does-the-second-call-erase-the-effects-of-the-first-call">Question 2: "Are the expectations appended to the mock object or does the second call erase the effects of the first call?"<a class="headerlink" href="#question-2-are-the-expectations-appended-to-the-mock-object-or-does-the-second-call-erase-the-effects-of-the-first-call" title="Permanent link">&para;</a></h3>
<p>The above description answers this question as well. Essentially, the <code>EXPECT_CALL</code> expectations do NOT override the effects of any <code>EXPECT_CALL</code>s before them, <strong>unless</strong> the matchers (values specified to be passed to the mock methods) are identical or overlapping, in which case only the <em>last</em> <code>EXPECT_CALL</code> will ever get called at all, as it is always reached before the others in the matching sequence. Therefore, don't have duplicate <code>EXPECT_CALL</code>s with the same matchers on a given mocked method or else you could be inadvertently forcing the test to <em>always fail</em>, since the above <code>EXPECT_CALL</code>s will never get called. This is discussed at length in Question 1 above.</p>
<p>Again, for more reading on this topic, read above, and see my other answer here: https://stackoverflow.com/questions/44249293/google-mock-how-to-say-function-must-be-called-once-with-a-certain-parameter/60896373#60896373.</p>
<hr />
<h3 id="question-3-can-i-call-expect_call-to-set-some-expectations-on-a-mock-method-call-the-mock-method-then-call-expect_call-on-the-method-again-to-change-the-expectations-then-call-the-mock-method-again">Question 3: Can I call <code>EXPECT_CALL</code> to set some expectations on a mock method, call the mock method, then call <code>EXPECT_CALL</code> on the method again to change the expectations, then call the mock method again?<a class="headerlink" href="#question-3-can-i-call-expect_call-to-set-some-expectations-on-a-mock-method-call-the-mock-method-then-call-expect_call-on-the-method-again-to-change-the-expectations-then-call-the-mock-method-again" title="Permanent link">&para;</a></h3>
<p>This question wasn't even <em>explicitly</em> asked by the OP, but the only reason I found this page is because I was searching for this answer for many hours and couldn't find it. My Google search was "<a href="https://www.google.com/search?sxsrf=ALeKk00e6UHbLaPL3B5-042GF9KQRt9QhA%3A1585335955965&amp;ei=k05-Xq7LOri10PEPwL-ciA8&amp;q=gmock%20multiple%20expect_call&amp;oq=gmock%20multiple%20&amp;gs_l=psy-ab.3.1.0l3j0i22i30l7.2786111.2787311..2789283...0.4..0.305.1339.0j8j0j1......0....1..gws-wiz.......0i71.e3x6IuEQpb0">gmock multiple expect_call</a>." Therefore, others asking this question will also fall on this page and need a conclusive answer.</p>
<p>A: NO, you can NOT do this! Although it may <em>seem to work in testing</em>, according to Google, it produces <em>undefined behavior</em>. See general rule #2 above!</p>
<blockquote>
<p>"<strong>Important note:</strong> gMock requires expectations to be set <strong>before</strong> the mock functions are called, otherwise the behavior is <strong>undefined</strong>. In particular, you mustn't interleave <code>EXPECT_CALL()</code>s and calls to the mock functions" (https://github.com/google/googletest/blob/master/googlemock/docs/for_dummies.md#using-mocks-in-tests)</p>
</blockquote>
<p>Therefore, this is NOT ALLOWED!</p>
<pre><code>// EXAMPLE OF A BAD TEST THAT MAY SEEM TO WORK BUT IS RELYING ON *UNDEFINED* BEHAVIOR!
// The goal is to ensure that `myMockMethod()` is only called 2x the first time by
// `myOtherFunc()`, 3x the second time, and 0x the last time.

// Google states: "**Important note:** gMock requires expectations to be set
// **before** the mock functions are called, otherwise the behavior is **undefined**.
// In particular, you mustn't interleave `EXPECT_CALL()`s and calls to the mock functions"
// (https://github.com/google/googletest/blob/master/googlemock/docs/for_dummies.md#using-mocks-in-tests)

using ::testing::_;

TEST_F(MyTestFixture, MyCustomTest)
{
    // `myMockMethod()` should be called only 2x here by `myOtherFunc()`,
    // despite calling `myOtherFunc()` repeatedly
    EXPECT_CALL(MyMockClass, myMockMethod(_, _))
        .Times(2);
    for (int i = 0; i &lt; 10; i++)
    {
        myOtherFunc();
    }

    // UNDEFINED BEHAVIOR BEGINS HERE: you can't interleave calls to `EXPECT_CALL` with
    // calls to the mocked functions (in this case: `myMockMethod()`,
    // which is called by `myOtherFunc()`).

    // THEN `myMockMethod()` should be called 3x here by `myOtherFunc()`
    EXPECT_CALL(MyMockClass, myMockMethod(_, _))
        .Times(3);
    for (int i = 0; i &lt; 10; i++)
    {
        myOtherFunc();
    }

    // LAST, `myMockMethod()` should be called 0x here by `myOtherFunc()`
    EXPECT_CALL(MyMockClass, myMockMethod(_, _))
        .Times(0);
    for (int i = 0; i &lt; 10; i++)
    {
        myOtherFunc();
    }
}
</code></pre>
<p>So, what's a valid solution here? Well, if you can break this test up into 3 different, independent tests, just do that! But, what if these 3 tests are interconnected in such a way you cannot separate them? Example: you are trying to test a throttling function which throttles print output to only once per second, for instance, even if you try to print more often that that per second. Well, in this case there are some work-arounds.</p>
<p>First, let's review: per the <a href="https://github.com/google/googletest/blob/master/googlemock/docs/cheat_sheet.md#setting-expectations-expectcall">Google Mock Cheat Sheet</a>, here are the ways to configure an <code>EXPECT_CALL()</code>:</p>
<pre><code>EXPECT_CALL(mock-object, method (matchers)?)
     .With(multi-argument-matcher)  ?
     .Times(cardinality)            ?
     .InSequence(sequences)         *
     .After(expectations)           *
     .WillOnce(action)              *
     .WillRepeatedly(action)        ?
     .RetiresOnSaturation();        ?
</code></pre>
<blockquote>
<p>For each item above, <code>?</code> means it can be used at most once, while <code>*</code> means it can be used any number of times.</p>
</blockquote>
<p>We need to use the <code>.WillRepeatedly(action)</code> option with an <code>action</code> which <a href="https://github.com/google/googletest/blob/master/googlemock/docs/cheat_sheet.md#side-effects">produces side effects</a> or <a href="https://github.com/google/googletest/blob/master/googlemock/docs/cheat_sheet.md#using-a-function-functor-or-lambda-as-an-action">calls a function, functor, or lambda</a> as an action.</p>
<p>Here are some work-arounds to safely and correctly perform the above test which had undefined behavior. <em>If you want to see the best approach first, just jump straight down to #3 below:</em></p>
<ol>
<li>
<p><strong>Use <code>Assign(&amp;variable, value)</code>.</strong> In this particular case, this is a bit hacky, but it does work properly. For a simpler test case you may have, this might be the perfect way to do what you need. Here's a viable solution:</p>
<p>Side note: an error output I got while trying to run a gmock test said:</p>
<blockquote>
<p><code>.Times()</code> cannot appear after <code>.InSequence()</code>, <code>.WillOnce()</code>, <code>.WillRepeatedly()</code>, or <code>.RetiresOnSaturation()</code>,</p>
</blockquote>
<p>...so it turns out we don't need to (and we are not even <em>allowed to</em>) specify <code>.Times(::testing::AnyNumber())</code> here. Instead, gmock will figure it out automatically, according to <a href="https://github.com/google/googletest/blob/master/googlemock/docs/for_dummies.md#cardinalities-how-many-times-will-it-be-called">these cardinality rules</a>, since we are using <code>.WillRepeatedly()</code>:</p>
<blockquote>
<p><strong>If you omit <code>Times()</code>, gMock will infer the cardinality for you.</strong> The rules are easy to remember:</p>
<ul>
<li>If <strong>neither</strong> <code>WillOnce()</code> nor <code>WillRepeatedly()</code> is in the <code>EXPECT_CALL()</code>, the inferred cardinality is <code>Times(1)</code>.</li>
<li>If there are <em>n</em> <code>WillOnce()</code>'s but <strong>no</strong> <code>WillRepeatedly()</code>, where <em>n</em> &gt;= 1, the cardinality is <code>Times(n)</code>.</li>
<li>If there are <em>n</em> <code>WillOnce()</code>'s and <strong>one</strong> <code>WillRepeatedly()</code>, where <em>n</em> &gt;= 0, the cardinality is <code>Times(AtLeast(n))</code>.</li>
</ul>
</blockquote>
<p><em>This technique has actually been tested and proven to work on real code:</em></p>
<pre><code>using ::testing::_;
using ::testing::Assign;

TEST_F(MyTestFixture, MyCustomTest)
{
    bool myMockMethodWasCalled = false;

    EXPECT_CALL(MyMockClass, myMockMethod(_, _))
        // Set `myMockMethodWasCalled` to true every time `myMockMethod()` is called with
        // *any* input parameters!
        .WillRepeatedly(Assign(&amp;myMockMethodWasCalled, true));

    // Do any necessary setup here for the 1st sub-test

    // Test that `myMockMethod()` is called only 2x here by `myOtherFunc()`,
    // despite calling `myOtherFunc()` repeatedly
    for (int i = 0; i &lt; 10; i++)
    {
        myOtherFunc();

        if (i &lt; 2)
        {
            EXPECT_TRUE(myMockMethodWasCalled);
            myMockMethodWasCalled = false;        // reset
            EXPECT_FALSE(myMockMethodWasCalled);  // ensure reset works (sanity check)
        }
        else
        {
            EXPECT_FALSE(myMockMethodWasCalled);
        }
    }

    // Do any necessary setup here for the 2nd sub-test

    // Test that `myMockMethod()` is called only 3x here by `myOtherFunc()`,
    // despite calling `myOtherFunc()` repeatedly
    for (int i = 0; i &lt; 10; i++)
    {
        myOtherFunc();

        if (i &lt; 3)
        {
            EXPECT_TRUE(myMockMethodWasCalled);
            myMockMethodWasCalled = false;        // reset
            EXPECT_FALSE(myMockMethodWasCalled);  // ensure reset works (sanity check)
        }
        else
        {
            EXPECT_FALSE(myMockMethodWasCalled);
        }
    }

    // Do any necessary setup here for the 3rd sub-test

    // Test that `myMockMethod()` is called 0x here by `myOtherFunc()`,
    // despite calling `myOtherFunc()` repeatedly
    for (int i = 0; i &lt; 10; i++)
    {
        myOtherFunc();
        EXPECT_FALSE(myMockMethodWasCalled);
    }
}
</code></pre>
</li>
<li>
<p><strong>Use <code>InvokeWithoutArgs(f)</code> with a global counter variable and a global counter function.</strong> This works great, and is much easier to use and more versatile than the previous approach! Note that you could also migrate this global function and variable to be inside your test fixture class as well if you wanted, which would clean it up a bit.</p>
<p><em>This technique has actually been tested and proven to work on real code:</em></p>
<pre><code>using ::testing::_;
using ::testing::InvokeWithoutArgs;

static uint32_t callCounter = 0;
static void incrementCallCounter()
{
    callCounter++;
}

TEST_F(MyTestFixture, MyCustomTest)
{
    EXPECT_CALL(MyMockClass, myMockMethod(_, _))
        // Set gmock to increment the global `callCounter` variable every time
        // `myMockMethod()` is called with *any* input parameters!
        .WillRepeatedly(InvokeWithoutArgs(incrementCallCounter));

    // Do any necessary setup here for the 1st sub-test

    // Test that `myMockMethod()` is called only 2x here by `myOtherFunc()`,
    // despite calling `myOtherFunc()` repeatedly
    callCounter = 0; // ensure this is zero BEFORE you start the test!
    for (int i = 0; i &lt; 10; i++)
    {
        myOtherFunc();
    }
    EXPECT_EQ(callCounter, 2);

    // Do any necessary setup here for the 2nd sub-test

    // Test that `myMockMethod()` is called only 3x here by `myOtherFunc()`,
    // despite calling `myOtherFunc()` repeatedly
    callCounter = 0; // ensure this is zero BEFORE you start the test!
    for (int i = 0; i &lt; 10; i++)
    {
        myOtherFunc();
    }
    EXPECT_EQ(callCounter, 3);

    // Do any necessary setup here for the 1st sub-test

    // Test that `myMockMethod()` is called 0x here by `myOtherFunc()`,
    // despite calling `myOtherFunc()` repeatedly
    callCounter = 0; // ensure this is zero BEFORE you start the test!
    for (int i = 0; i &lt; 10; i++)
    {
        myOtherFunc();
    }
    EXPECT_EQ(callCounter, 0);
}
</code></pre>
</li>
<li>
<p><strong>[BEST TECHNIQUE] Use <code>InvokeWithoutArgs(f)</code> with a <em>local</em> counter variable and a simple lambda function!</strong> This works great, and is much easier to use and more versatile than the 1st approach, while avoiding the global variable and additional global function of the 2nd approach. It is for sure my favorite way to handle this, and works extremely well.</p>
<p><em>This technique has actually been tested and proven to work on real code:</em></p>
<pre><code>using ::testing::_;
using ::testing::InvokeWithoutArgs;

TEST_F(MyTestFixture, MyCustomTest)
{
    uint32_t callCounter;

    EXPECT_CALL(MyMockClass, myMockMethod(_, _))
        // Use a lambda function to set gmock to increment `callCounter` every
        // time `myMockMethod()` is called with *any* input parameters!
        .WillRepeatedly(InvokeWithoutArgs([&amp;callCounter](){ callCounter++; }));

    // Do any necessary setup here for the 1st sub-test

    // Test that `myMockMethod()` is called only 2x here by `myOtherFunc()`,
    // despite calling `myOtherFunc()` repeatedly
    callCounter = 0; // ensure this is zero BEFORE you start the test!
    for (int i = 0; i &lt; 10; i++)
    {
        myOtherFunc();
    }
    EXPECT_EQ(callCounter, 2);

    // Do any necessary setup here for the 2nd sub-test

    // Test that `myMockMethod()` is called only 3x here by `myOtherFunc()`,
    // despite calling `myOtherFunc()` repeatedly
    callCounter = 0; // ensure this is zero BEFORE you start the test!
    for (int i = 0; i &lt; 10; i++)
    {
        myOtherFunc();
    }
    EXPECT_EQ(callCounter, 3);

    // Do any necessary setup here for the 1st sub-test

    // Test that `myMockMethod()` is called 0x here by `myOtherFunc()`,
    // despite calling `myOtherFunc()` repeatedly
    callCounter = 0; // ensure this is zero BEFORE you start the test!
    for (int i = 0; i &lt; 10; i++)
    {
        myOtherFunc();
    }
    EXPECT_EQ(callCounter, 0);
}
</code></pre>
</li>
</ol>
<p>If you think this whole answer should be added as a stand-alone file among the Gmock docs (I propose we do this), click the github issue link just below and upvote it.</p>
<h2 id="practice-using-gtestgmock">Practice using gtest/gmock:<a class="headerlink" href="#practice-using-gtestgmock" title="Permanent link">&para;</a></h2>
<ol>
<li>Use this project to practice writing and testing your own google tests and google mocks. This is also a good demo of how to get a new project up and running with Google's <a href="https://bazel.build/">Bazel build system</a>: https://github.com/ElectricRCAircraftGuy/eRCaGuy_gtest_practice.</li>
</ol>
<h2 id="related">Related:<a class="headerlink" href="#related" title="Permanent link">&para;</a></h2>
<ol>
<li>GitHub issue I opened to request to add this answer as a standalone document in their official documentation. If you agree, please go here and upvote this issue: <a href="https://github.com/google/googletest/issues/2775">https://github.com/google/googletest/issues/2775</a></li>
<li><a href="https://stackoverflow.com/questions/44249293/google-mock-how-to-say-function-must-be-called-once-with-a-certain-parameter/60896373#60896373">https://stackoverflow.com/questions/44249293/google-mock-how-to-say-function-must-be-called-once-with-a-certain-parameter/60896373#60896373</a></li>
<li><a href="https://stackoverflow.com/questions/5743236/google-mock-multiple-expectations-on-same-function-with-different-parameters/5899945">https://stackoverflow.com/questions/5743236/google-mock-multiple-expectations-on-same-function-with-different-parameters/5899945</a></li>
<li><a href="https://stackoverflow.com/questions/44249293/google-mock-how-to-say-function-must-be-called-once-with-a-certain-parameter">https://stackoverflow.com/questions/44249293/google-mock-how-to-say-function-must-be-called-once-with-a-certain-parameter</a></li>
</ol>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../../gtest/googlemock/docs/community_created_documentation/" title="Links" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Links
              </div>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.3636a4ec.min.js"></script>
      <script src="../../assets/javascripts/bundle.e9fe3281.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>